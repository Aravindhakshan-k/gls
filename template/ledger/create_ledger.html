{% extends "includes/base.html" %}
{% load static %}

{% block body_content %}
<div class="nk-content">
    <div class="container-fluid">
        <div class="nk-content-inner">
            <div class="nk-content-body">
                <div class="nk-block-head nk-block-head-sm">
                    <div class="nk-block-between">
                        <div class="nk-block-head-content">
                            <h3 class="nk-block-title page-title">Create Ledger</h3>
                        </div>
                    </div>
                </div>
                <div class="nk-block">
                    <div class="card">
                        <div class="card-inner">
                            <form id="ledger-form" method="post">
                                {% csrf_token %}

                                  <input type="hidden" class="form-control" name="account_type" value="ledger" required>
                                
                                <div class="row g-4">
                                    <!-- First Column Fields -->
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-label">Ledger Name</label>
                                            <input type="text" class="form-control" name="ledger_name" required>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-label">Print Name</label>
                                            <input type="text" class="form-control" name="print_name" required>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-label">Parent Group</label>
                                            <select class="form-control" name="parent_group" required>
                                                <option value="">Select Group</option>
                                                <option value="group1">group1</option>
                                                <!-- Add group options dynamically -->
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-label">Team</label>
                                            <select class="form-control" name="team">
                                                <option value="">Select Team</option>
                                                <option value="team1">team1</option>
                                                <!-- Add team options dynamically -->
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-label">Mobile Number</label>
                                            <input type="number" class="form-control" name="mobile_number" pattern="[0-9]{10}" required>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-label">City</label>
                                            <input type="text" class="form-control" name="city" required>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-label">Area</label>
                                            <input type="text" class="form-control" name="area" required>
                                        </div>
                                    </div>
                                    
                                    <!-- Second Column Fields -->
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-label">Business Type</label>
                                            <input type="text" class="form-control" name="business_type" required>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-label">GST Number</label>
                                            <input type="text" class="form-control" name="gst_no"  required>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-label">PAN Number</label>
                                            <input type="text" class="form-control" name="pan_no" required>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-label">Address</label>
                                            <textarea class="form-control" name="address" rows="2" required></textarea>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-label">Pincode</label>
                                            <input type="number" class="form-control" name="pincode" pattern="[0-9]{6}" required>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-label">State</label>
                                            <input type="text" class="form-control" name="state" required>
                                        </div>
                                    </div>
                                    
                                    <!-- Opening Balance Fields -->
                                    <div class="col-lg-6">
                                      <div class="form-group">
                                        <label class="form-label">Opening Balance (Amount)</label>
                                        <div class="input-group">
                                          <input type="number" class="form-control" name="opening_balance_amount" step="0.01">
                                          <select class="form-select" name="amount_cr_dr" style="max-width: 150px;">
                                            <option value="cr">CREDIT</option>
                                            <option value="dr">DEBIT</option>
                                          </select>
                                        </div>
                                      </div>
                                    </div>
                                    <div class="col-lg-6">
                                      <div class="form-group">
                                        <label class="form-label">Opening Balance (Pure Weight)</label>
                                        <div class="input-group">
                                          <input type="number" class="form-control" name="opening_balance_pure_weight" step="0.001">
                                          <select class="form-select" name="weight_cr_dr" style="max-width: 150px;">
                                            <option value="cr">CREDIT</option>
                                            <option value="dr">DEBIT</option>
                                          </select>
                                        </div>
                                      </div>
                                    </div>
                                    
                                    <div class="col-12">
                                        <div class="form-group">
                                            <button type="submit" class="btn btn-primary float-end">Save Ledger</button>
                                            <a href="{% url 'ledger-list' %}" class="btn btn-secondary float-end me-2">Cancel</a>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block foot_script %}
<script>
$(document).ready(function() {
    $('#ledger-form').on('submit', function(e) {
        
        e.preventDefault();
        
        let formData = new FormData(this);
        
        $.ajax({
            url: "{% url 'ajax-create-ledger' %}",
            type: "POST",
            data: formData,
            processData: false,
            contentType: false,
            success: function(response) {
                if(response.status === "success") {
                    toastr.success(response.message);
                    setTimeout(function() {
                        window.location.href = "{% url 'ledger-list' %}";
                    }, 1500);
                } else {
                    toastr.error(response.message);
                }
            },
            error: function(xhr, errmsg, err) {
                toastr.error("An error occurred while saving the ledger.");
            }
        });
    });
});
</script>
{% endblock %}