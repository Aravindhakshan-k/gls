{% extends "includes/base.html" %}
{% load static %}

{% block extra_css %}
<style>
    .form-section-title {
        font-size: 1rem;
        font-weight: 600;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid #dbdfea;
        color: #364a63;
    }
    .required-field::after {
        content: " *";
        color: #e85347;
    }
</style>
{% endblock %}

{% block body_content %}
<div class="nk-content">
    <div class="container-fluid">
        <div class="nk-content-inner">
            <div class="nk-content-body">
                <div class="nk-block-head nk-block-head-sm">
                    <div class="nk-block-between">
                        <div class="nk-block-head-content">
                            <h3 class="nk-block-title page-title">Edit Ledger</h3>
                        </div>
                        <div class="nk-block-head-content">
                            <a href="{% url 'ledger-list' %}" class="btn btn-outline-light">
                                <em class="icon ni ni-arrow-left"></em><span>Back to List</span>
                            </a>
                        </div>
                    </div>
                </div>
                <div class="nk-block">
                    <div class="card">
                        <div class="card-inner">
                            <form id="ledgerForm">
                                {% csrf_token %}
                                <input type="hidden" name="ledger_id" value="{{ ledger.id }}">
                                
                                <div class="row g-4">
                                    <div class="col-12">
                                        <h5 class="form-section-title">Basic Information</h5>
                                    </div>
                                    
                                    <!-- Basic Info -->
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-label required-field">Ledger Name</label>
                                            <input type="text" class="form-control" name="name" value="{{ ledger.name }}" required>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-label">Print Name</label>
                                            <input type="text" class="form-control" name="print_name" value="{{ ledger.print_name }}">
                                        </div>
                                    </div>
                                    
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-label required-field">Ledger Group</label>
                                            <select class="form-select" name="ledger_group" required>
                                                <option value="">Select Ledger Group</option>
                                                <option value="assets" {% if ledger.ledger_group == 'assets' %}selected{% endif %}>Assets</option>
                                                <option value="liabilities" {% if ledger.ledger_group == 'liabilities' %}selected{% endif %}>Liabilities</option>
                                                <option value="income" {% if ledger.ledger_group == 'income' %}selected{% endif %}>Income</option>
                                                <option value="expenses" {% if ledger.ledger_group == 'expenses' %}selected{% endif %}>Expenses</option>
                                                <option value="capital" {% if ledger.ledger_group == 'capital' %}selected{% endif %}>Capital</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-label">Opening Balance</label>
                                            <div class="form-control-wrap">
                                                <div class="input-group">
                                                    <input type="number" step="0.01" class="form-control" name="opening_balance_amount" value="{{ ledger.opening_balance_amount }}">
                                                    <div class="input-group-append">
                                                        <select class="form-select" name="opening_balance_type">
                                                            <option value="debit" {% if ledger.opening_balance_type == 'debit' %}selected{% endif %}>Dr</option>
                                                            <option value="credit" {% if ledger.opening_balance_type == 'credit' %}selected{% endif %}>Cr</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-12">
                                        <h5 class="form-section-title">Contact Information</h5>
                                    </div>
                                    
                                    <!-- Contact Information -->
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-label">Contact Person</label>
                                            <input type="text" class="form-control" name="contact_person_name" value="{{ ledger.contact_person_name }}">
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-label">Phone Number</label>
                                            <input type="text" class="form-control" name="phone_number" value="{{ ledger.phone_number }}">
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-label">Mobile Number</label>
                                            <input type="text" class="form-control" name="mobile_number" value="{{ ledger.mobile_number }}">
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-label">Email</label>
                                            <input type="email" class="form-control" name="email" value="{{ ledger.email }}">
                                        </div>
                                    </div>
                                    
                                    <div class="col-12">
                                        <h5 class="form-section-title">Address</h5>
                                    </div>
                                    
                                    <!-- Address -->
                                    <div class="col-lg-4">
                                        <div class="form-group">
                                            <label class="form-label">Door No</label>
                                            <input type="text" class="form-control" name="door_no" value="{{ ledger.door_no }}">
                                        </div>
                                    </div>
                                    <div class="col-lg-8">
                                        <div class="form-group">
                                            <label class="form-label">Address</label>
                                            <input type="text" class="form-control" name="address" value="{{ ledger.address }}">
                                        </div>
                                    </div>
                                    <div class="col-lg-4">
                                        <div class="form-group">
                                            <label class="form-label">City</label>
                                            <input type="text" class="form-control" name="city" value="{{ ledger.city }}">
                                        </div>
                                    </div>
                                    <div class="col-lg-4">
                                        <div class="form-group">
                                            <label class="form-label">State</label>
                                            <input type="text" class="form-control" name="state" value="{{ ledger.state }}">
                                        </div>
                                    </div>
                                    <div class="col-lg-4">
                                        <div class="form-group">
                                            <label class="form-label">Pincode</label>
                                            <input type="text" class="form-control" name="pincode" value="{{ ledger.pincode }}">
                                        </div>
                                    </div>
                                    
                                    <div class="col-12">
                                        <h5 class="form-section-title">Tax Information</h5>
                                    </div>
                                    
                                    <!-- Tax Information -->
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-label">GST Registration Type</label>
                                            <select class="form-select" name="gst_registration_type">
                                                <option value="">Select Registration Type</option>
                                                <option value="regular" {% if ledger.gst_registration_type == 'regular' %}selected{% endif %}>Regular</option>
                                                <option value="composition" {% if ledger.gst_registration_type == 'composition' %}selected{% endif %}>Composition</option>
                                                <option value="unregistered" {% if ledger.gst_registration_type == 'unregistered' %}selected{% endif %}>Unregistered</option>
                                                <option value="consumer" {% if ledger.gst_registration_type == 'consumer' %}selected{% endif %}>Consumer</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-label">GSTIN/UIN</label>
                                            <input type="text" class="form-control" name="gst_no" value="{{ ledger.gst_no }}">
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-label">PAN Number</label>
                                            <input type="text" class="form-control" name="pan_number" value="{{ ledger.pan_number }}">
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-label">TDS Applicable</label>
                                            <div class="custom-control custom-switch">
                                                <input type="checkbox" class="custom-control-input" id="tdsApplicable" name="tds_applicable" value="1" {% if ledger.tds_applicable %}checked{% endif %}>
                                                <label class="custom-control-label" for="tdsApplicable">Yes</label>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-12">
                                        <h5 class="form-section-title">Bank Details</h5>
                                    </div>
                                    
                                    <!-- Bank Details -->
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-label">Bank Name</label>
                                            <input type="text" class="form-control" name="bank_name" value="{{ ledger.bank_name }}">
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-label">Account Number</label>
                                            <input type="text" class="form-control" name="account_number" value="{{ ledger.account_number }}">
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-label">IFSC Code</label>
                                            <input type="text" class="form-control" name="ifsc_code" value="{{ ledger.ifsc_code }}">
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="form-label">Branch</label>
                                            <input type="text" class="form-control" name="bank_branch" value="{{ ledger.bank_branch }}">
                                        </div>
                                    </div>
                                    
                                    <div class="col-12">
                                        <div class="form-group">
                                            <label class="form-label">Remarks</label>
                                            <textarea class="form-control" name="remarks" rows="3">{{ ledger.remarks }}</textarea>
                                        </div>
                                    </div>
                                    
                                    <div class="col-12">
                                        <div class="form-group">
                                            <button type="submit" class="btn btn-primary">Update Ledger</button>
                                            <a href="{% url 'ledger-list' %}" class="btn btn-outline-light">Cancel</a>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block foot_script %}
<script>
$(document).ready(function() {
    // Form submission
    $('#ledgerForm').on('submit', function(e) {
        e.preventDefault();
        
        var formData = new FormData(this);
        
        $.ajax({
            url: "{% url 'ajax_update_ledger' %}",
            type: "POST",
            data: formData,
            processData: false,
            contentType: false,
            success: function(response) {
                if(response.status === "success") {
                    alert(response.message);
                    window.location.href = "{% url 'ledger-list' %}";
                } else {
                    alert("Error: " + response.message);
                }
            },
            error: function(xhr, errmsg, err) {
                alert("Error occurred while updating ledger.");
            }
        });
    });

    // Auto-fill print name based on ledger name if empty
    $('input[name="name"]').on('blur', function() {
        if ($('input[name="print_name"]').val() === '') {
            $('input[name="print_name"]').val($(this).val());
        }
    });
});
</script>
{% endblock %} 