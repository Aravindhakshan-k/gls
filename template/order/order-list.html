{% extends "includes/base.html" %}
{% load static %}
 {% block body_content %}
<div class="nk-content nk-content-fluid">
            <div class="container-xl wide-xl">
              <div class="nk-content-body">
                <div class="components-preview wide-xl mx-auto">
                  <div class="nk-block nk-block-lg">
                    <div class="nk-block-head">
                    <div class="nk-block-between">
                      <div class="nk-block-head-content">
                        <h4 class="nk-block-title">Order List</h4>
                      </div>
                      <div class="nk-block-head-content">
                      <div class="toggle-wrap nk-block-tools-toggle">
                        <a href="#" class="btn btn-icon btn-trigger toggle-expand me-n1" data-target="pageMenu">
                          <em class="icon ni ni-menu-alt-r"></em>
                        </a>
                        <div class="toggle-expand-content" data-content="pageMenu">
                          <ul class="nk-block-tools g-3">
                            <li>
                              <a href="#" class="btn btn-white btn-outline-light">
                                <em class="icon ni ni-download-cloud"></em>
                                <span>Export</span>
                              </a>
                            </li>
                            <li class="nk-block-tools-opt">
                              <button type="button" class="btn btn-icon btn-primary" data-bs-toggle="modal" data-bs-target="#ordermodalForm">
                                <em class="icon ni ni-plus"></em>
                            </button>
                            </li>
                          </ul>
                        </div>
                      </div>
                    </div>
                    </div>
                    </div>
                    <div class="card card-preview">
                      <div class="card-inner">
                        <table class="datatable-init nowrap nk-tb-list nk-tb-ulist" data-auto-responsive="false">
                          <thead>
                            <tr class="nk-tb-item nk-tb-head">
                              <th class="nk-tb-col nk-tb-col-check">
                                <div class="custom-control custom-control-sm custom-checkbox notext">
                                  <input type="checkbox" class="custom-control-input" id="uid">
                                  <label class="custom-control-label" for="uid"></label>
                                </div>
                              </th>
                              <th class="nk-tb-col">
                                <span class="sub-text">Order No</span>
                              </th>
                              <th class="nk-tb-col tb-col-mb">
                                <span class="sub-text">Delivery by</span>
                              </th>
                              <th class="nk-tb-col tb-col-md">
                                <span class="sub-text">Order Status</span>
                              </th>
                              <th class="nk-tb-col tb-col-lg">
                                <span class="sub-text">Order Created</span>
                              </th>
                              <th class="nk-tb-col tb-col-md">
                                <span class="sub-text">Status</span>
                              </th>
                              <th class="nk-tb-col nk-tb-col-tools text-end"></th>
                            </tr>
                          </thead>
                          <tbody>
                            {% for data in orders %}
                            <tr class="nk-tb-item">
                              <td class="nk-tb-col nk-tb-col-check">
                                <div class="custom-control custom-control-sm custom-checkbox notext">
                                  <input type="checkbox" class="custom-control-input" id="uid13">
                                  <label class="custom-control-label" for="uid13"></label>
                                </div>
                              </td>
                              <td class="nk-tb-col">
                                <div class="user-card">
                                  <div class="user-avatar bg-dark d-none d-sm-flex">
                                    <span>{{ data.customer.first_name|slice:":1" }}{{ data.customer.last_name|slice:":1" }}</span>
                                  </div>
                                  <div class="user-info">
                                    <span class="tb-lead">{{data.order_number}} <span class="dot dot-success d-md-none ms-1"></span>
                                    </span>
                                    <span>{{ data.customer.first_name }}{{ data.customer.last_name }}</span>
                                  </div>
                                </div>
                              </td>
                              <td class="nk-tb-col tb-col-mb" data-order="440.34">
                                <span class="tb-amount">{{data.delivery_date}}</span>
                              </td>
                              <td class="nk-tb-col tb-col-md">
                                <span>{{data.status}}</span>
                              </td>
                              <td class="nk-tb-col tb-col-lg">
                                <span>{{data.created_at}}</span>
                              </td>
                              <td class="nk-tb-col tb-col-md">
                                {% if data.is_active == 1 %}
                                  <span class="tb-status text-success">Active</span>
                                {% else %}
                                  <span class="tb-status text-danger">Inactive</span>
                                {% endif %}
                              </td>
                              <td class="nk-tb-col nk-tb-col-tools">
                                <ul class="nk-tb-actions gx-1">
                                  <li class="nk-tb-action-hidden">
                                    <a href="#" class="btn btn-trigger btn-icon" data-bs-toggle="tooltip" data-bs-placement="top" title="Wallet">
                                      <em class="icon ni ni-wallet-fill"></em>
                                    </a>
                                  </li>
                                  <li class="nk-tb-action-hidden">
                                    <a href="#" class="btn btn-trigger btn-icon" data-bs-toggle="tooltip" data-bs-placement="top" title="Send Email">
                                      <em class="icon ni ni-mail-fill"></em>
                                    </a>
                                  </li>
                                  <li class="nk-tb-action-hidden">
                                    <a href="#" class="btn btn-trigger btn-icon" data-bs-toggle="tooltip" data-bs-placement="top" title="Suspend">
                                      <em class="icon ni ni-user-cross-fill"></em>
                                    </a>
                                  </li>
                                  <li>
                                    <div class="drodown">
                                      <a href="#" class="dropdown-toggle btn btn-icon btn-trigger" data-bs-toggle="dropdown">
                                        <em class="icon ni ni-more-h"></em>
                                      </a>
                                      <div class="dropdown-menu dropdown-menu-end">
                                        <ul class="link-list-opt no-bdr">
                                          <li>
                                            <a href="#">
                                              <em class="icon ni ni-focus"></em>
                                              <span>Quick View</span>
                                            </a>
                                          </li>
                                          <li>
                                            <a href="#">
                                              <em class="icon ni ni-eye"></em>
                                              <span>View Details</span>
                                            </a>
                                          </li>
                                          <li>
                                            <a href="#">
                                              <em class="icon ni ni-repeat"></em>
                                              <span>Transaction</span>
                                            </a>
                                          </li>
                                          <li>
                                            <a href="#">
                                              <em class="icon ni ni-activity-round"></em>
                                              <span>Activities</span>
                                            </a>
                                          </li>
                                          <li class="divider"></li>
                                          <li>
                                            <a href="#">
                                              <em class="icon ni ni-shield-star"></em>
                                              <span>Reset Pass</span>
                                            </a>
                                          </li>
                                          <li>
                                            <a href="#">
                                              <em class="icon ni ni-shield-off"></em>
                                              <span>Reset 2FA</span>
                                            </a>
                                          </li>
                                          <li>
                                            <a href="#">
                                              <em class="icon ni ni-na"></em>
                                              <span>Suspend User</span>
                                            </a>
                                          </li>
                                        </ul>
                                      </div>
                                    </div>
                                  </li>
                                </ul>
                              </td>
                            </tr>
                          </tbody>
                            {% endfor %}
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="modal fade" id="ordermodalForm">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Order Info</h5>
                    <a href="#" class="close" data-bs-dismiss="modal" aria-label="Close">
                    <em class="icon ni ni-cross"></em>
                    </a>
                </div>
                <div class="modal-body">
                    <form action="#" class="form-validate is-alter" id="orderaddform" enctype="multipart/form-data">
                      {% csrf_token %}
                    <div class="form-group">
                      <label class="form-label" for="customer-select">Customer Name</label>
                      <div class="form-control-wrap">
                        <select class="form-control select2" id="customer-select" name="customer_id" required>
                          <option value="">Select a customer</option>
                          {% for customer in customers %}
                            <option value="{{ customer.id }}">{{ customer.first_name }}{{ customer.last_name }}</option>
                          {% endfor %}
                        </select>
                      </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="order-number">Order Number</label>
                        <div class="form-control-wrap">
                        <input type="number" class="form-control" name="order_number" id="order-number" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="delivery_date">Delivery Date</label>
                        <div class="form-control-wrap">
                        <input type="date" class="form-control" id="delivery_date" name="delivery_date" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="note">Note</label>
                        <div class="form-control-wrap">
                        <input type="text" class="form-control" id="note" name="note">
                        </div>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-lg btn-primary">Save Order</button>
                    </div>
                    </form>
                </div>
                </div>
            </div>
            </div>
{% endblock %}
{% block foot_script %}
<script>
$("#orderaddform").validate({
    rules: {
        order_number: {
            required: true
        },
    },
    messages: {
        order_number: {
            required: "Please enter order number",
        },
    },
  submitHandler: function(form) {
    var data = new FormData($('form').get(0));
    $.ajax({
        url: 'ajax-add-order',
        data: data,
        cache: false,
        processData: false,
        contentType: false,
        method: 'POST',
        dataType: 'json',
        beforeSend: function() {
        $(".page_loading").show();
        },
        success: function (data) {
            $(".page_loading").hide();

            toastr.options = {
                "closeButton": true,
                "progressBar": true,
                "positionClass": "toast-top-right", 
                "timeOut": "5000",
                "extendedTimeOut": "1000"
            };

            if(data['status']=="success") {
              toastr.success(data['message'], "Success");
                setTimeout(function() {
                    window.location.href = "/order/order-list";
                }, 1500);
            } else {
              toastr.error(data['message'], "Error");;
              } 
        }
    });
    return false;
  }
});

</script>
{% endblock %}